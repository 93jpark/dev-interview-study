## 정규화

### 정규화 탄생 배경
소프트웨어 크기가 커질수록, 테이블과 컬럼들이 많아질수록 모델링을 잘못하거나 모델링한 테이블이 좋은지 나쁜지 판단하기 어려워진다.
<br>

### 정규화란
- 관계형 데이터베이스의 핵심적 개념으로 **데이터의 이상 현상**을 제거하고, **데이터 중복을 최소화**하는 것이다.
- 데이터의 중복이 있는 경우 **Insert, Update, Delete**시
데이터간 **정합성**이 깨지는 이상 현상이 발생한다. 이를 방지하기 위해, 테이블에
같은 필드가 중복되지 않도록 테이블을 분리하는 과정이다.
- 단, 테이블 분리 시 데이터 손실이 가해지지 않는 **무손실 분해** 원칙을 지켜야 한다.

> 정합성: 데이터들의 값이 서로 일치함
<br>

### 데이터의 이상 현상
테이블내의 데이터 중복성에 의해서 발생되는 데이터 불일치 현상

- `삽입 이상(insertion anomaly)` : 불필요한 정보를 함께 저장하지 않고서는 어떤 정보를 저장하는 것이 불가능
- `수정 이상(update anomaly)` : 반복된 데이터 중에 일부를 갱신 할 시 데이터의 불일치 발생 
- `삭제 이상(eletion anomaly)` : 필요한 정보를 함께 삭제하지 않고서는 어떤 정보를 삭제하는 것이 불가능

<br>

### 정규화의 종류
예시를 살펴보며 `정규화의 종류`를 설명한다.<br>
다음은 **영화의 정보**를 담은 테이블이다.<br><br>
![image](https://user-images.githubusercontent.com/43839951/203487828-abe1acb1-2e57-4463-b878-f72386241bf0.png)

**tag 컬럼**의 값 갱신 시 이상 현상이 발생 할 여지가 있다.

<br>

#### 제1 정규화
- **제1 정규형(1NF,First Normal Form)** 을 만드는 규칙
- 값이 **원자적**이어야 한다

예시의 tag 컬럼 값을 **원자 값**으로 만들기 위하여 다양한 방법을 시도해 본다.

![image](https://user-images.githubusercontent.com/43839951/203487863-26a512d2-fe73-4521-abfd-e4e8b1cad09d.png)[그림1-1]
<br><br>
위의 경우 tag 컬럼의 값은 원자화 되지만 중복 데이터가 발생하여 공간의 낭비가 발생한다.

![image](https://user-images.githubusercontent.com/43839951/203487885-52e56031-01a2-4b77-bff2-6e74cb81b2bf.png)
[그림1-2]<br><br>
[그림1-1]의 문제점을 해결하기 위하여 **tag 값을 1,2로 구분**해보았다.  
만일, tag 값이 하나인 경우라면 tag_2의 값은 
**NULL 값이** 되므로 마찬가지로 공간의 낭비가 발생한다.

Q. **1) 새로운 중복을 발생시키지 않으며  2) 공간 낭비가 없는** 방법은 무엇일까?

![image](https://user-images.githubusercontent.com/43839951/203487896-26c147e4-c861-4f4f-909d-2b348ad5ef84.png)<br><br>
tag 컬럼을 테이블로 만들어 **id 값**을 부여하면, topic,tag의 2개 테이블이 생긴다. <br>이때, topic 테이블의 각 title 값이 어떤 tag
속성을 가지고 있는지 알려줄 **topic_tag_relation** 테이블을 만들어 연결 관계를 만들어준다.

<br>

#### 제2 정규화
- **제2 정규형(2NF,Second Normal Form)** 을 만드는 규칙
- **부분 종속성**이 없어야 한다<br><br>

![image](https://user-images.githubusercontent.com/43839951/203487910-57602264-69ff-4e75-9dfb-4bc1cd542f5b.png)

그림을 보면 **topic 테이블**에 **중복 데이터**가 존재한다는 것을 알 수 있다.<br>
**데시벨** 영화의 정보가 변경 때 다음과 같은 문제의 발생 가능성이 있다.
- type이 액션에서 스릴러로 변경되었는데 1개의 값만 변경 된 경우

![image](https://user-images.githubusercontent.com/43839951/203487936-5addf44e-38b4-4ddc-ba08-24b546ac49b1.png)

**부분적 종속성**을 가지는 컬럼과 **전체 종속성**을 가지는 컬럼을 구분하여
**topic, topic_actor 테이블**로 구분하였다. 이때, **title을 topic_actor의 기본키**로 설정하여 topic과의 연관성을 표시한다.
<br><br>
![image](https://user-images.githubusercontent.com/43839951/203487990-82847420-1cc3-44e3-8ee5-c7d4ed743ba9.png)
**제2 정규화**를 만족하였지만 **author_** 에서 또 다른 **종속성**이 발생한다.<br>
table을 살펴보면 author_phone 컬럼은
**author_id**에 의하여 결정되고 다른 컬럼과는 연관이 되지 않는 것을 알 수 있다.

<br>

#### 제3 정규화
- **제3 정규형(3NF,Third Normal Form)** 을 만드는 규칙
- **이행적 종속성**을 제거
<br><br>
![image](https://user-images.githubusercontent.com/43839951/203488005-af8e87b5-2100-49f3-8cd1-2028ad7ce66c.png)

<br><br>
author와 관련된 컬럼들은 따로 테이블로 만든다.

![image](https://user-images.githubusercontent.com/43839951/203488027-cf50a9f2-d94e-4049-8ab6-23bdcb1b6b47.png)

만일 작가가 영화를 만들어 영화사에 보냈지만, 아직 개봉 일정이 정해지지 않은 경우를 생각해보자.<br>
아직 개봉 날짜(created)가 정해지지 않아 topic에 영화를 추가 할 수 없을 것이다.
<br><Br>

#### BCNF
- **제3 정규형**보다 **엄격한 제약 조건**을 가지고 있어 **strong 3NF**라고도 한다

![image](https://user-images.githubusercontent.com/43839951/203488063-2d344643-7b64-40f3-bbb3-9367ee7c80df.png)

설명을 위해 테이블을 분리하였지만, 최종 테이블에는 반영하지 않는다.<br><br>
#### 결과
**제1-3정규화**를 거쳐 만들어진 최종 테이블은 다음과 같다.

![image](https://user-images.githubusercontent.com/43839951/203488048-f48aeb6e-a259-40a1-8069-123c93dae645.png)

### 정규화의 장단점
#### 장점
- DB 변경시 발생하는 갱신이상 문제들을 해결해준다 : **일관성 유지**
- 새로운 데이터 형의 추가로 인한 확장 시, **일부 변경**이 가능하다.
- 데이터 구조의 **안정성 및 무결성**을 유지해준다
#### 단점
- 테이블 간 **JOIN 연산**이 다수 발생하여 응답시간이 길어짐
<br><br>
### 결론
select 문의 발생 빈도 수를 파악하여 **정규화와 비정규화**를 적절히 사용하는 것이 중요
<br><br>
>[Reference]<br>
>[관계형 데이터 모델링 - 6.4. 제3 정규화](https://www.youtube.com/watch?v=aS9FoCNlt3o)<br>
>[제 3정규형(3NF)와 이행적 종속성에 대해 살펴보자](https://jhnyang.tistory.com/360)<br>
>[데이터베이스 이상 현상(Anomaly)](https://1000hg.tistory.com/22)<br>
>[데이터베이스 정규화 - BCNF](https://yaboong.github.io/database/2018/03/10/database-normalization-2/)
>[정규화 (제1 정규화 ~ 제3 정규화)](https://mr-dan.tistory.com/10)